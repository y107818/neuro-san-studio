# Copyright © 2025 Cognizant Technology Solutions Corp, www.cognizant.com.
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
#
# END COPYRIGHT

#Add NYT and Guardian API Keys as environment variables
#Install newspaper3k, vaderSentiment, backoff, lxml-html-cleans

{
    include "registries/aaosa.hocon"
    
    "metadata": {
        "description": "Multi-agent system that analyzes news articles from The New York Times, The Guardian, and Al Jazeera to reveal how topics, events, or individuals are emotionally framed across diverse geopolitical perspectives. Uses keyword-driven VADER sentiment analysis to generate data-backed insights highlighting variations in tone, polarity, and narrative emphasis.",
        "tags": ["sentiment_analysis", "tool", "AAOSA"],
        "sample_queries": [
            "Perform sentiment analysis on news related to space in different sources across the globe.",
            "Compare how different news outlets cover climate change.",
            "Analyze the sentiment of election coverage across NYT, Guardian, and Al Jazeera.",
        ]
    },
    "llm_config": {
        "model_name": "bedrock-us-claude-sonnet-4",
    },
    "max_iterations": 40000,
    "max_execution_seconds": 6000,
    "instructions_prefix": """
    You are part of a news_sentiment_analysis_network of assistants.
    Only answer inquiries that are directly within your area of expertise.
    Do not try to help for other matters.
    Do not mention what you can NOT do. Only mention what you can do.
    """,

    "tools": [
        # This first agent definition is regarded as the "Front Man", which
        # does all the talking to the outside world/client.
        #
        # Some disqualifications from being a front man:
        #   1) Cannot use a CodedTool "class" definition
        #   2) Cannot use a Tool "toolbox" definition
        #
        # Besides the first agent being the front man, these tool definitions
        # do not have to be in any particular order. How they are linked and
        # call each other is defined within their own specs.
        # This could be a graph, potentially even with cycles.
        {
            "name": "news_query_manager",
            "function": {
                "description": "I oversee sentiment analysis of media coverage, coordinating a pipeline to evaluate sentiment, bias, tone, and emotional framing across news sources."
                },
            "instructions": ${instructions_prefix} """
            You are the top-level agent named news_query_manager, 
            responsible for managing sentiment analysis of how a topic is portrayed in the media. 
            Act as the sole interface for the user—never mention or expose internal tools or agents.
            Follow this sequential step-by-step workflow:
            Step 1: Interpret User Query  
            - Extract relevant keywords such as people, places, topics, and events.  
            - Identify the news source: 'nyt', 'guardian', 'aljazeera', or default to 'all'.  
            - Format the input as: {{"source": "<source_name>", "keywords": "<comma_separated_keywords>"}} to pass to news_api_specialist.
            Step 2: Retrieve Articles  
            - Call news_api_specialist ONLY ONCE with the input from Step 1 to retrieve a directory of .txt articles.  
            - Use the returned file path to construct input for sentiment_analysis_expert:  
            {{"source": "<source_name>", "keywords": "<comma_separated_keywords>", "file_path": "<path_to_input_files>"}}
            Step 3: Analyze Sentiment  
            - Call sentiment_analysis_expert with the formatted input.  
            - The expected output is a .json file containing sentences with keywords, sentiment scores (positive, negative, neutral, compound), averages, and per-source analytics.  
            - Pass this .json file as input to data_analyst.
            Step 4: Generate Final Report  
            - Call data_analyst to analyze the sentiment-tagged dataset and generate a summary report.  
            - Return the final report to the user.
            Always follow this order: first news_api_specialist, then sentiment_analysis_expert, and finally data_analyst.  
            Never skip or repeat steps.
            """ ${aaosa_instructions},
            "tools": ["news_api_specialist", "sentiment_analysis_expert", "data_analyst"]
        },
        {
            "name": "data_analyst",
            "function": ${aaosa_call},
            "instructions": ${instructions_prefix} """
            Produce a comprehensive sentiment analysis report that is detailed, quantitative, and based on clear inferences. 
            The average compound sentiment scores for each source and overall sentiment in this format: "<source_name>": "avg_compound": <..>,
            Use the EXACT scores from the JSON file. Do NOT invent/fabricate sources, scores, or examples.
            Include all these report Sections:
            1. Sentiment Analysis:
            - Report the avg_compound score for each outlet and overall in report.
            - Explain what the score means for each outlet’s tone, stance (positive, negative, neutral) and support with tone patterns and examples for each outlet.
            - Analyze emotional framing: mention if coverage evokes fear, hope, anger, or neutrality, and explain variations across outlets and topics with examples for each outlet.
            2. Tone Variation and Examples:
            - Give real topics/headlines example from each outlet.
            3. Media Bias:
            - Compare tone and emotional framing on SIMILAR topics and overall across outlets.
            - Identify possible editorial bias (ONLY if supported by clear differences in tone or framing).
            - Compare optimism, criticism, or neutrality across sources.
            4. Key Insights:
            - Summarize the analysis and conclude the report.
            """ ${aaosa_instructions} 
        },
        {
            "name": "news_api_specialist",
            "function": {
                "description": """The news_api_specialist retrieves keyword-based news articles from NYT, Guardian, and Al Jazeera, extracts content using newspaper3k, and stores 
                them in structured directories.""",
                "parameters": {
                    "type": "object",
                    "properties": {
                        "keywords": {
                            "type": "string",
                            "description": "Keywords given by the user that you need to search the news articles for."
                        },
                        "source": {
                            "type": "string",
                            "description": "Can be 'nyt', 'guardian', 'aljazeera', or 'all' depending on which newspaper/newspapers the user wants scrapped.",
                            "default": "all"
                        },
                    },
                    "required": ["keywords", "source"]
                }
            },
            "class": "web_scraping_technician.WebScrapingTechnician"
        },
        {
            "name": "sentiment_analysis_expert",
            "function": {
                "description": """You are the `sentiment_analysis_expert`. Analyze emotional tone and sentiment - compound, positive, negative and neutral - of news articles using VADER sentiment.""",
                "parameters": {
                    "type": "object",
                    "properties": {
                        #add file path as input
                        "keywords": {
                            "type": "string",
                            "description": "Keywords given by the user that you need to search the news articles for."
                        },
                        "source": {
                            "type": "string",
                            "description": "Can be 'nyt', 'guardian', 'aljazeera', or 'all' depending on which newspaper/newspapers the user wants scrapped.",
                            "default": "all"
                        },
                    },
                    "required": ["keywords", "source"]
                }
            },
            "class": "sentiment_analysis.SentimentAnalysis"
        },
    ]
}
